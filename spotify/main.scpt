if application "Spotify" is running then
	tell application "Spotify"
		if player state is playing then
			set trackText to my trackInfo()
			set artistText to my artistInfo()
			set albumText to my albumInfo()
			set menuBarLength to (get length of (trackText & " - " & artistText))
			if menuBarLength > 50 then
			    set shortOutput to text 1 thru 47 of (trackText & " - " & artistText)
				return shortOutput & "... | symbolize=true\n---\nTrack: " & trackText & "\nArtist: " & artistText & "\nAlbum: " & albumText
			else
  			    return trackText & " - " & artistText & " | symbolize=true\n---\nAlbum: " & albumText
			end if
		else
			return "| templateImage=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\n---\nNothing playing on Spotify"
		end if
	end tell
else
	return "| templateImage=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\n---\nSpotify not running"
end if
on trackInfo()
	try
		tell application "Spotify"
			return name of current track
		end tell
	on error
		return "Oops. Couldn't get track info"
	end try
end trackInfo
on artistInfo()
	tell application "Spotify"
		return artist of current track
	end tell
end artistInfo
on albumInfo()
	tell application "Spotify"
		return album of current track
	end tell
end albumInfo
